<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using collector() for large data sets • ideadata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using collector() for large data sets">
<meta property="og:description" content="ideadata">
<meta property="og:image" content="https://idea-analytics.github.io/ideadata/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ideadata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/setting-up-your-credentials.html">Setting up your credentials</a>
    </li>
    <li>
      <a href="../articles/using-collector.html">Using collector() for large data sets</a>
    </li>
    <li>
      <a href="../articles/using-get_table.html">Using get_table()</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using-collector_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using collector() for large data sets</h1>
            
      
      
      <div class="hidden name"><code>using-collector.Rmd</code></div>

    </div>

    
    
<p>Some of our datasets are large and moving them from that database to your computer can take a fair amount of time. So long in fact that is not uncommon for our connections to die.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Additionally, you tend not to get a lot of feedback when using <code>dplyr</code>’s <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> function to return the data to your computer. It either gets the data silently or dies trying.</p>
<p>For this reason, <code>ideadata</code> has a <code><a href="../reference/collector.html">collector()</a></code> function. It’s used the same way as <code>collect</code>, but requires you to pass parameters (i.e., column names for the table you are trying to collect ) that are used to break your data into pieces based on the set of values within the columns you identify.</p>
<p>Consider the <code>StudentDailyAttendance</code> table on <code>PROD1</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading ideadata</span>
<span class="co">#library(ideadata)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="va">stu_attendance</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_student_daily_attendance.html">get_student_daily_attendance</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">stu_attendance</span><span class="op">)</span>
<span class="co">#&gt; Rows: ??</span>
<span class="co">#&gt; Columns: 49</span>
<span class="co">#&gt; Database: Microsoft SQL Server 13.00.5888[IPS\christopher.haid@1065574-SQLPRD1/PROD1]</span>
<span class="co">#&gt; $ AcademicYear         [3m[38;5;246m&lt;chr&gt;[39m[23m "2020-2021", "2020-2021", "2020-2021", "2020-2021", "2020-2021", "2020…</span>
<span class="co">#&gt; $ SchoolTermID         [3m[38;5;246m&lt;dbl&gt;[39m[23m 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000, 3000…</span>
<span class="co">#&gt; $ SchoolName           [3m[38;5;246m&lt;chr&gt;[39m[23m "IDEA Frontier College Preparatory", "IDEA Academy Primary", "IDEA Edg…</span>
<span class="co">#&gt; $ schoolnumber         [3m[38;5;246m&lt;dbl&gt;[39m[23m 108807003, 3, 109907024, 109907003, 108807117, 108807195, 108807037, 1…</span>
<span class="co">#&gt; $ StateSchoolNumber    [3m[38;5;246m&lt;dbl&gt;[39m[23m 108807003, 108807101, 108807202, 108807040, 108807117, 108807195, 1088…</span>
<span class="co">#&gt; $ SchoolShortName      [3m[38;5;246m&lt;chr&gt;[39m[23m "Frontier", "Donna", "Edgecliff", "Rio Vista", "Tres Lagos", "Harlinge…</span>
<span class="co">#&gt; $ SchoolType           [3m[38;5;246m&lt;chr&gt;[39m[23m "College Prep", "Academy", "College Prep", "College Prep", "Academy", …</span>
<span class="co">#&gt; $ VPofSchools          [3m[38;5;246m&lt;dbl&gt;[39m[23m 175, 5779, 9888, 5124, 5062, 175, 6158, 5062, 5062, 5062, 463, 5779, 5…</span>
<span class="co">#&gt; $ VPofSchoolsName      [3m[38;5;246m&lt;chr&gt;[39m[23m "Alex Anzaldua", "Stephanie Sullenger", "Christine Diaz", "Rebecca Cob…</span>
<span class="co">#&gt; $ RegionID             [3m[38;5;246m&lt;dbl&gt;[39m[23m 7, 7, 9, 5, 7, 7, 1, 7, 7, 7, 2, 7, 7, 1, 1, 9, 7, 2, 1, 7, 1, 1, 7, 5…</span>
<span class="co">#&gt; $ RegionDescription    [3m[38;5;246m&lt;chr&gt;[39m[23m "Rio Grande Valley", "Rio Grande Valley", "Tarrant County", "El Paso",…</span>
<span class="co">#&gt; $ GradeLevelID         [3m[38;5;246m&lt;dbl&gt;[39m[23m 11, 0, 6, 7, 4, 0, 10, 8, 8, 8, 6, 1, 2, 6, 3, 1, 2, 6, 7, 9, 5, 7, 1,…</span>
<span class="co">#&gt; $ GradeLevel           [3m[38;5;246m&lt;chr&gt;[39m[23m "11", "K", "6", "7", "4", "K", "10", "8", "8", "8", "6", "1", "2", "6"…</span>
<span class="co">#&gt; $ AttStudentKey        [3m[38;5;246m&lt;dbl&gt;[39m[23m 42609066, 42609067, 42609068, 42609069, 42609070, 42609071, 42610932, …</span>
<span class="co">#&gt; $ StudentNumber        [3m[38;5;246m&lt;dbl&gt;[39m[23m 108006521, 108087122, 108114827, 108088137, 108064960, 108110230, 1080…</span>
<span class="co">#&gt; $ FirstName            [3m[38;5;246m&lt;chr&gt;[39m[23m "Angel", "Bella", "Daisy", "Lorenzo", "Jesus", "Carolina", "Katty", "C…</span>
<span class="co">#&gt; $ LastName             [3m[38;5;246m&lt;chr&gt;[39m[23m "Duran", "Soto", "Torres", "Escobedo", "Cantu", "Flores", "Alvarado", …</span>
<span class="co">#&gt; $ FullName             [3m[38;5;246m&lt;chr&gt;[39m[23m "Duran, Angel Gabriel", "Soto, Bella Rose", "Torres, Daisy", "Escobedo…</span>
<span class="co">#&gt; $ WeekNumber           [3m[38;5;246m&lt;chr&gt;[39m[23m "38", "38", "38", "38", "38", "38", "38", "38", "38", "38", "38", "38"…</span>
<span class="co">#&gt; $ DateNumber           [3m[38;5;246m&lt;int&gt;[39m[23m 157, 157, 156, 148, 157, 157, 155, 157, 157, 157, 155, 157, 157, 155, …</span>
<span class="co">#&gt; $ AttDate              [3m[38;5;246m&lt;date&gt;[39m[23m 2021-04-30, 2021-04-30, 2021-04-30, 2021-04-30, 2021-04-30, 2021-04-3…</span>
<span class="co">#&gt; $ Membership           [3m[38;5;246m&lt;dbl&gt;[39m[23m 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, …</span>
<span class="co">#&gt; $ Absences             [3m[38;5;246m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ VAbsences            [3m[38;5;246m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ SPED                 [3m[38;5;246m&lt;int&gt;[39m[23m 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ ELL                  [3m[38;5;246m&lt;int&gt;[39m[23m 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0…</span>
<span class="co">#&gt; $ LEP                  [3m[38;5;246m&lt;int&gt;[39m[23m 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0…</span>
<span class="co">#&gt; $ Farm                 [3m[38;5;246m&lt;int&gt;[39m[23m 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1…</span>
<span class="co">#&gt; $ CSI                  [3m[38;5;246m&lt;int&gt;[39m[23m 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ NonSpedEllCsi        [3m[38;5;246m&lt;int&gt;[39m[23m 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1…</span>
<span class="co">#&gt; $ Ethnicity            [3m[38;5;246m&lt;chr&gt;[39m[23m "White", "White", "White", "White", "White", "White", "White", "White"…</span>
<span class="co">#&gt; $ Hispanic             [3m[38;5;246m&lt;int&gt;[39m[23m 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ ContinuouslyEnrolled [3m[38;5;246m&lt;chr&gt;[39m[23m "True", "False", "False", "False", "True", "False", "False", "True", "…</span>
<span class="co">#&gt; $ AtRisk               [3m[38;5;246m&lt;int&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ PersistenceType      [3m[38;5;246m&lt;int&gt;[39m[23m 3, 3, 1, 3, 3, 1, 3, 3, 3, 3, 1, 3, 1, 3, 1, 1, 3, 3, 3, 3, 1, 3, 3, 1…</span>
<span class="co">#&gt; $ SchoolYear           [3m[38;5;246m&lt;chr&gt;[39m[23m "2+", "2+", "1", "2+", "2+", "1", "2+", "2+", "2+", "2+", "2+", "2+", …</span>
<span class="co">#&gt; $ DayAfterEvent        [3m[38;5;246m&lt;chr&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ EventDate            [3m[38;5;246m&lt;date&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">#&gt; $ MaxTempinF           [3m[38;5;246m&lt;dbl&gt;[39m[23m 78.3, 78.3, 67.5, NA, 78.3, 78.3, 68.9, 78.3, 78.3, 78.3, 74.5, 78.3, …</span>
<span class="co">#&gt; $ AvgTempInF           [3m[38;5;246m&lt;dbl&gt;[39m[23m 74.6, 74.6, 63.1, NA, 74.6, 74.6, 68.2, 74.6, 74.6, 74.6, 68.6, 74.6, …</span>
<span class="co">#&gt; $ MinTempInF           [3m[38;5;246m&lt;dbl&gt;[39m[23m 71.4, 71.4, 59.2, NA, 71.4, 71.4, 65.3, 71.4, 71.4, 71.4, 66.2, 71.4, …</span>
<span class="co">#&gt; $ CompareKey           [3m[38;5;246m&lt;chr&gt;[39m[23m "175|Alex Anzaldua|7|Rio Grande Valley|3000|108807003|11|108006521|202…</span>
<span class="co">#&gt; $ RdoEmployeeID        [3m[38;5;246m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ RdoEmployeeName      [3m[38;5;246m&lt;chr&gt;[39m[23m "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""…</span>
<span class="co">#&gt; $ SchoolTypeOperation  [3m[38;5;246m&lt;chr&gt;[39m[23m "FULL SCALE", "FULL SCALE", "LAUNCHING", "FULL SCALE", "FULL SCALE", "…</span>
<span class="co">#&gt; $ Enroll               [3m[38;5;246m&lt;int&gt;[39m[23m 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ Area                 [3m[38;5;246m&lt;chr&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ SubRegionID          [3m[38;5;246m&lt;dbl&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ SubRegionDescription [3m[38;5;246m&lt;chr&gt;[39m[23m NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#school years are stored as characters, which is inefficient for filtering</span>
<span class="co"># TermIDs are doubles (thought they really ought be integers), but are </span>
<span class="co"># much faster for filtering. </span>

<span class="va">term_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_ps_termid.html">calc_ps_termid</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>


<span class="va">stu_attend_2021</span> <span class="op">&lt;-</span> <span class="va">stu_attendance</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SchoolTermID</span> <span class="op">==</span> <span class="va">term_id</span><span class="op">)</span>

<span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="va">stu_attend_2021</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">n_rows</span>
<span class="co">#&gt; [1] 3723612</span></code></pre></div>
<p>So as of the October 21, 2021 there are 3,723,612 student attendance records. That will be a tall order for <code>collect</code> so instead lets use <code>collector</code>.</p>
<p><code>collector</code> takes column names, uses thosecolumns to get all combinations of variables that appear in the data, and then uses those combinations to pull your data down in smaller chunks defined be each combination (e.g., for each school and data, as shown below).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">collection_data_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>

<span class="va">stu_attend_2021_temp</span> <span class="op">&lt;-</span> <span class="va">stu_attendance</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">StudentNumber</span>, <span class="va">AttDate</span>, <span class="va">schoolnumber</span> , <span class="va">Membership</span>, <span class="va">Absences</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">AttDate</span> <span class="op">&gt;=</span> <span class="st">'2021-10-08'</span>, 
         <span class="va">SchoolNumber</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'108807186'</span>, <span class="st">'108807187'</span>, <span class="st">'108807302'</span>, <span class="st">'109907024'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  

  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">compute</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Created a temporary table named #dbplyr_007</span>

 
<span class="va">stu_attend_2021_collected</span> <span class="op">&lt;-</span>  <span class="va">stu_attend_2021_temp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/collector.html">collector</a></span><span class="op">(</span><span class="va">AttDate</span>, <span class="va">schoolnumber</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Collecting data</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-08', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-08', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-08', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-08', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-12', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-12', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-12', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-12', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-13', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-13', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-13', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-13', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-14', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-14', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-14', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-14', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-18', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-18', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-18', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-18', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-19', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-19', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-19', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-19', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-20', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-20', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-20', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-20', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-21', schoolnumber == '108807186' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-21', schoolnumber == '108807187' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-21', schoolnumber == '108807302' ...</span>
<span class="co">#&gt; Pulling data filtered to: AttDate == '2021-10-21', schoolnumber == '109907024' ...</span>
<span class="co">#&gt; Data collection complete</span></code></pre></div>
<p>Note the call to <code><a href="https://dplyr.tidyverse.org/reference/compute.html">dplyr::compute()</a></code> in the code above (highlighted).</p>
<p>What is that <code><a href="https://dplyr.tidyverse.org/reference/compute.html">compute()</a></code> call doing?</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/compute.html">compute()</a></code> forces the database to evaluate all the prior steps (i.e. a filter, a select, and another filter), after which the will create a temporary table there (i.e., a table which get’s deleted when your conenction closes.</p>
<p>Wihout this step each iteration created by <code><a href="../reference/collector.html">collector()</a></code> (via <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_df()</a></code>) will re run the the magrittr pipeline, of which the tw filter steps are computationally expensive. A caveat with this desing pattern is you need to have permissions to write temporary tables to the database. If you can’t do that, then you’ll have to suffer the pain of waiting for the DB to run all of your <code>magrittr</code> pipeline (i.e., all the stuff following each <code><a href="../reference/%&gt;%.html">%&gt;%</a></code>) for each iteration.</p>
<p>In any case, here are the results of the call, witht eh student numbers masked by an sha1 cryptohash:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stu_attend_2021_feb</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>student_number <span class="op">=</span> <span class="fu">openssl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/hash.html">sha1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">student_number</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#crypto hash</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in head(., 20): object 'stu_attend_2021_feb' not found</span></code></pre></div>
<p>Notice that the table <code>stu_attendance</code> (i.e, <code>STudentDailyAttendance</code> on <code>PROD1</code>) has 49 columns. A trick used above is to reduce the columns to only those you need to use later with a <code>select</code> statement early in the data pipeline; doing so greatly reduces the amount of data you are requesting from the database.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>I don’t really understand why this happens<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Chris Haid.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
